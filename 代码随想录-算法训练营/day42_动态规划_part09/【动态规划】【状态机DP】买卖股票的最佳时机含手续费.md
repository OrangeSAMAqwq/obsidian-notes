# 题目：买卖股票的最佳时机含手续费（Best Time to Buy and Sell Stock with Transaction Fee）💸📈💰

---

## 🧠 题目理解

给定：

- `prices[i]`：第 `i` 天股票价格
- `fee`：每次交易的手续费

规则：

- 可以进行 **多次交易**
- 同一时间只能持有 0 或 1 支股票
- 每完成一笔交易需要支付一次手续费 `fee`

目标：最大利润。

---

## 🔍 问题建模：股票状态机 DP + 手续费

股票 DP 的核心仍然不变：

- 持有股票
- 不持有股票

手续费的影响就是：

> **每次完成一笔交易都要扣钱**  
> 只要把手续费放到 “买入” 或 “卖出” 任意一侧扣掉即可（但必须只扣一次）

你选择的是：**在买入时扣手续费** ✅

---

## ✨ 状态设计

### 状态定义

```text
dp[i][0]：第 i 天结束时，手里【持有股票】的最大收益
dp[i][1]：第 i 天结束时，手里【不持有股票】的最大收益
```

---

### 初始化

```cpp
dp[0][0] = -prices[0] - fee; // 第一天买入并支付手续费
dp[0][1] = 0;
```

---

## 🔁 状态转移方程

### 1️⃣ 持有股票 dp[i][0]

两种来源：

- 前一天就持有（今天不买）
- 前一天不持有，今天买入（买入时扣手续费）

```text
dp[i][0] = max(
    dp[i-1][0],
    dp[i-1][1] - prices[i] - fee
)
```

---

### 2️⃣ 不持有股票 dp[i][1]

两种来源：

- 前一天就不持有（今天不卖）
- 前一天持有，今天卖出（卖出时不扣手续费，因为已经在买入时扣过）

```text
dp[i][1] = max(
    dp[i-1][1],
    dp[i-1][0] + prices[i]
)
```

---

## 💻 代码实现（你的版本）

```cpp
class Solution {
public:
    int maxProfit(vector<int>& prices, int fee) {
        int n = prices.size();
        vector<vector<int>> dp(n, vector<int>(2, 0));
        dp[0][0] = -prices[0] - fee;
        for (int i = 1; i < n; i++){
            dp[i][0] = max(dp[i - 1][0], dp[i - 1][1] - prices[i] - fee);
            dp[i][1] = max(dp[i - 1][1], dp[i - 1][0] + prices[i]);
        }
        return dp[n - 1][1];
    }
};
```

---

## 🧠 手续费放哪扣？（记忆点）

手续费可以放在：

✅ 买入时扣：

```text
buy = sell - price - fee
```

或 ✅ 卖出时扣：

```text
sell = buy + price - fee
```

但必须保证：

> **每笔交易只扣一次 fee**

你的写法属于第一种：买入扣费，卖出不扣 ✅

---

## ⏱️ 复杂度分析

- 时间复杂度：`O(n)`
- 空间复杂度：`O(n)`  
  （可压缩到 `O(1)`）

---

## 🧾 小结

本题相对股票 II 的唯一变化：

- 买入时多扣一个 `fee`

```text
dp[i][0] = max(dp[i-1][0], dp[i-1][1] - prices[i] - fee)
```

因此它仍然是同一个股票状态机模板的自然扩展 ✅
